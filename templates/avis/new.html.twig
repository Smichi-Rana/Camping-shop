{% extends 'base.html.twig' %}

{% block title %}Laisser un avis{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="card shadow-sm p-4 mx-auto" style="max-width: 600px;">
            <h2 class="mb-4 text-center">Laisser un avis</h2>

            {{ form_start(form) }}

            <div class="form-group mb-3">
                <label>Note</label>
                <div class="stars-container mb-2">
                    {% for i in 1..5 %}
                        <span class="star" data-value="{{ i }}">&#9733;</span>
                    {% endfor %}
                </div>
                {{ form_widget(form.note) }}
            </div>

            <div class="form-group mb-3">
                {{ form_row(form.commentaire, {
                    'attr': {'placeholder': 'Ã‰crivez votre avis ici...', 'class': 'form-control'}
                }) }}
            </div>

            <div class="text-center">
                <button class="btn btn-primary btn-lg">Envoyer</button>
            </div>

            {{ form_end(form) }}
        </div>
    </div>

    <style>
        .card {
            border-radius: 12px;
            background-color: #f9f9f9;
        }
        .stars-container {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
        }
        .star {
            font-size: 2.5em;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
            margin: 0 5px;
        }
        .star:hover,
        .star.hovered,
        .star.selected {
            color: #FFD700;
            transform: scale(1.2);
        }
        @media (max-width: 600px) {
            .star {
                font-size: 2em;
                margin: 0 3px;
            }
        }
    </style>

    <script>
        const stars = document.querySelectorAll('.star');
        const noteInput = document.getElementById('{{ form.note.vars.id }}');

        function updateStars(value) {
            stars.forEach(s => {
                if(s.dataset.value <= value) s.classList.add('selected');
                else s.classList.remove('selected');
            });
        }

        stars.forEach(star => {
            star.addEventListener('mouseenter', () => {
                stars.forEach(s => s.classList.remove('hovered'));
                stars.forEach(s => {
                    if(s.dataset.value <= star.dataset.value) s.classList.add('hovered');
                });
            });

            star.addEventListener('mouseleave', () => {
                stars.forEach(s => s.classList.remove('hovered'));
            });

            star.addEventListener('click', () => {
                const value = star.dataset.value;
                noteInput.value = value;
                updateStars(value);
            });
        });

        window.addEventListener('load', () => updateStars(noteInput.value || 0));
    </script>
{% endblock %}
