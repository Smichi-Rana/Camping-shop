{% extends 'base.html.twig' %}

{% block title %}Commande #{{ commande.id }}{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h1 class="mb-0">
                    <i class="fas fa-shopping-cart"></i> Commande #{{ commande.id }}
                </h1>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <th width="30%">ID</th>
                        <td>{{ commande.id }}</td>
                    </tr>
                    <tr>
                        <th>Numéro de Commande</th>
                        <td><strong>{{ commande.numeroCommande }}</strong></td>
                    </tr>
                    <tr>
                        <th>Date de commande</th>
                        <td>{{ commande.dateCommande ? commande.dateCommande|date('d/m/Y H:i') : '' }}</td>
                    </tr>
                    <tr>
                        <th>Statut</th>
                        <td>
                            <span class="badge bg-{{ commande.statusBadgeClass }}">
                                {{ commande.status }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <th>Montant Total</th>
                        <td><strong class="text-success fs-4">{{ commande.montantTotal }} €</strong></td>
                    </tr>
                    <tr>
                        <th>Nombre d'articles</th>
                        <td>{{ commande.nombreArticles }}</td>
                    </tr>
                    <tr>
                        <th>Client</th>
                        <td>
                            {% if commande.user %}
                                {{ commande.user.prenom }} {{ commande.user.nom }}
                                <br>
                                <small class="text-muted">{{ commande.user.email }}</small>
                            {% else %}
                                <em class="text-muted">Aucun client associé</em>
                            {% endif %}
                        </td>
                    </tr>
                    {% if commande.adresseLivraison %}
                        <tr>
                            <th>Adresse de livraison</th>
                            <td>{{ commande.adresseLivraison }}</td>
                        </tr>
                    {% endif %}
                    {% if commande.commentaire %}
                        <tr>
                            <th>Commentaire</th>
                            <td>{{ commande.commentaire }}</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>

                {# Affichage des lignes de commande #}
                <h3 class="mt-4">
                    <i class="fas fa-list"></i> Détails des articles
                </h3>
                {% if commande.ligneCommandes|length > 0 %}
                    <table class="table table-striped">
                        <thead class="table-dark">
                        <tr>
                            <th>Article</th>
                            <th class="text-center">Quantité</th>
                            <th class="text-end">Prix unitaire</th>
                            <th class="text-end">Sous-total</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for ligne in commande.ligneCommandes %}
                            <tr>
                                <td>{{ ligne.produit ?? 'Article' }}</td>
                                <td class="text-center">{{ ligne.quantite }}</td>
                                <td class="text-end">{{ ligne.prix }} €</td>
                                <td class="text-end">
                                    <strong>{{ (ligne.prix * ligne.quantite)|number_format(2, ',', ' ') }} €</strong>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot class="table-light">
                        <tr>
                            <td colspan="3" class="text-end"><strong>Total :</strong></td>
                            <td class="text-end">
                                <strong class="text-success fs-5">{{ commande.montantTotal }} €</strong>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Aucune ligne de commande pour le moment.
                    </div>
                {% endif %}

                {# Affichage de la facture si elle existe #}
                {% if commande.hasFacture %}
                    <div class="alert alert-success mt-4">
                        <h5>
                            <i class="fas fa-file-invoice"></i> Facture associée
                        </h5>
                        <p class="mb-1">
                            <strong>Numéro :</strong> {{ commande.facture.numCommande }}
                        </p>
                        <p class="mb-1">
                            <strong>Total :</strong> {{ commande.facture.total }} €
                        </p>
                        <p class="mb-0">
                            <strong>Date :</strong> {{ commande.facture.date ? commande.facture.date|date('d/m/Y') : '' }}
                        </p>
                    </div>
                {% endif %}

                {# Affichage des réclamations #}
                {% if commande.hasReclamations %}
                    <div class="alert alert-warning mt-4">
                        <h5>
                            <i class="fas fa-exclamation-triangle"></i> Réclamations ({{ commande.reclamations|length }})
                        </h5>
                        <ul class="mb-0">
                            {% for reclamation in commande.reclamations %}
                                <li>{{ reclamation.description ?? 'Réclamation' }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                {# Boutons d'action #}
                <div class="d-flex gap-2 mt-4">
                    <a href="{{ path('app_commande_index') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Retour à la liste
                    </a>
                    <a href="{{ path('app_commande_edit', {'id': commande.id}) }}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Modifier
                    </a>
                    {{ include('commande/_delete_form.html.twig') }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
